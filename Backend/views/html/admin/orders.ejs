<!DOCTYPE html>
<html lang="en">

<%- include("../../templates/head.ejs" , {title: 'Orders' }) %>


    <body class="bg-gradient-to-b from-pink-400 via-white to-gray-700 bg-no-repeat" style="scrollbar-width: none;">

        <%- include("../../templates/header.ejs") %>

            <main class=" flex flex-col lg:flex-row lg:p-5 py-5 w-full">
                <section class="w-full lg:w-1/5 px-5 py-5 border-r-2 border-pink-500">
                    <%- include("../../templates/dashboardSidebar.ejs" , {selected: 'orders' }) %>
                </section>
                <section class="relative flex flex-col flex-wrap w-full px-5 pt-8 overflow-x-scroll">
                    <div>
                        <ul class="flex text-white font-bold">
                            <li class="flex bg-pink-500 p-2 px-3 rounded-lg h-fit hover:bg-pink-400 mx-2">
                                <button class="flex px-1 focus:outline-none" onclick="filterButton()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-filter">
                                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                                    </svg>
                                    Filter
                                </button>
                            </li>
                        </ul>
                        <script>
                            function filterButton() {
                                let div = document.querySelector("#filterDiv")
                                div.classList.toggle('hidden')
                            }
                        </script>
                    </div>
                    <div id="filterDiv" class="absolute flex flex-col items-center justify-center w-full h-auto hidden">
                        <div class=" bg-black flex flex-col w-full lg:w-1/3  px-10 py-5 h-full">
                            <div class="relative ">
                                <button class="absolute right-0 mx-5" onclick="filterButton()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="white" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-x">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>

                            <div class="text-white  font-bold text-xl w-full text-center py-3">Filter</div>
                            <label class="text-white" for="id">Enter Order Id (optional)</label>
                            <input type="text" id="orderId" class="w-full p-3 my-2" placeholder="Order ID here" value="">

                            <label class="text-white" for="outletId">Enter Outler Id (optional)</label>
                            <input type="text" id="outletId" class="w-full p-3 my-2" placeholder="Outlet ID here"
                                value="">

                            <label class="text-white" for="status">Select Status</label>
                            <select name="status" id="status" class="w-full p-3 my-2">
                                <option value="" selected class="bg-gray-300">
                                    Not selected
                                </option>
                                <option value="Pending" class="bg-gray-300">
                                    Pending(use for not attended too)
                                </option>
                                <option value="Attended" class="bg-gray-300">
                                    Attended
                                </option>

                            </select>


                            <button class="bg-gray-300 rounded-lg px-3 py-2 w-fit " id="FilterButton">
                                Submit
                            </button>
                            <script>
                                let button = document.getElementById('FilterButton')
                                let id = JSON.parse(localStorage.getItem('halls-user')).id
                                button.addEventListener('click', async (e) => {
                                    let orderId = document.getElementById('orderId').value
                                    let outletId = document.getElementById('outletId').value
                                    let status = document.getElementById('status').value

                                    //sortAnchor.href = `/admin/products?id=${id}&ctg=all`
                                    let other = ''

                                    if (orderId) other += '&orderId=' + orderId
                                    if (outletId) other += '&outletId=' + outletId
                                    if (status) other += '&status=' + status

                                    window.location.href=`/admin/orders?id=${id}${other}`

                                    filterButton()
                                    
                                })
                            </script>
                        </div>
                    </div>

                    <div class='py-5 w-full '>
                        <% if(orders.length>0){ %>
                            <table class="table-auto overflow-scroll w-full">
                                <thead class="border-b bg-pink-600">
                                    <tr>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            ID
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            Outlet
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            User
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            Price
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            Attending
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            Slot
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            Status
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            #
                                        </th>
                                        <th scope="col" class="text-sm font-medium text-gray-900 px-6 py-4 text-left">
                                            Delete
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(let i=0 ; i< orders.length ; i++){ %>

                                        <tr class="border-b bg-white">
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <%= orders[i].id %>
                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <%= orders[i].outletId %>
                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <%= orders[i].first_name %>
                                                    <%= " " %>
                                                        <%= orders[i].last_name %>
                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <%= orders[i].price %>â‚¹
                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <%= orders[i].attend_date.toString().substring(0 , 16)
                                                    %>
                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <%= orders[i].slottime %>
                                            </td>
                                            <td class="text-sm text-white font-light px-6 py-2 whitespace-nowrap">
                                                <%if(orders[i].attend_date< new Date() ){%>
                                                    <% if(orders[i].attend_date.toString().slice(0 ,15)==new
                                                        Date().toString().slice(0 ,15)){ %>
                                                        <span class="px-2 bg-gray-500 p-2 rounded-md ">
                                                            Attending Today
                                                        </span>
                                                        <%}else{%>
                                                            <span class="px-2 bg-red-500 p-2 rounded-md">
                                                                Not Attended
                                                            </span>
                                                            <%}}else if(orders[i].status=='Attended' ){%>
                                                                <span class="px-2 bg-green-500 p-2 rounded-md">
                                                                    <%= orders[i].status %>
                                                                </span>
                                                                <%}else if(orders[i].status=='Pending' ){%>
                                                                    <span class="px-2 bg-yellow-500 p-2 rounded-md">
                                                                        <%= orders[i].status %>
                                                                    </span>
                                                                    <%}%>

                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <a href="/order/orderDetails?orderId=<%= orders[i].id%>">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                        viewBox="0 0 24 24" fill="none" stroke="green" stroke-width="2"
                                                        stroke-linecap="round" stroke-linejoin="round"
                                                        class="feather feather-eye">
                                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                        <circle cx="12" cy="12" r="3"></circle>
                                                    </svg>
                                                </a>
                                            </td>
                                            <td class="text-sm text-gray-900 font-light px-6 py-2 whitespace-nowrap">
                                                <button onclick="deleteOrder(this)" data-id="<%= orders[i].id %>">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                        viewBox="0 0 24 24" fill="none" stroke="red" stroke-width="2"
                                                        stroke-linecap="round" stroke-linejoin="round"
                                                        class="feather feather-trash-2">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path
                                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                        </path>
                                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                                    </svg>
                                                </button>
                                            </td>

                                        </tr>
                                        <% } %>
                                </tbody>
                            </table>

                            <%}else{%>

                                <div class="flex items-center justify-center px-5 py-3 bg-red-500 text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-frown">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M16 16s-1.5-2-4-2-4 2-4 2"></path>
                                        <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                        <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                    </svg>
                                    <span class="px-2">
                                        No Orders exits
                                    </span>
                                </div>
                                <%}%>
                </section>

            </main>
            <%- include("../../templates/footer.ejs") %>
    </body>
    <script>
        async function deleteOrder(ele) {
            let cnf = confirm('Are you sure?')
            if (cnf) {
                let id = ele.getAttribute('data-id')
                console.log(ele);
                let userId = JSON.parse(localStorage.getItem('halls-user')).id
                let res = await fetch(`/admin/orders/${id}/delete/${userId}`).then(r => r.json())
                if (res.code == 200) {
                    window.location.reload()
                } else {
                    alert('Something went wrong? try again')
                }
            }

        }
    </script>

</html>